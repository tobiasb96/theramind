{% load django_tables2 %}
{% load url_tab_param_persistence %}

{% load i18n %}
{% block table-wrapper %}
    <div class="table-container">
        {% block table %}
            <div class="overflow-x-auto">
                <table class="w-full table-auto text-md text-left rounded text-gray-500 dark:text-gray-400 dark:bg-gray-900 dark:border-gray-700">
                    {% block table.thead %}
                        {% if table.show_header %}
                            <thead class="text-xs text-gray-600 font-normal border border-blue-200 bg-blue-100 dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400">
                            <tr>
                                {% for column in table.columns %}
                                    <th scope="col" class="py-3 px-6">
                                        {% if column.orderable %}
                                            <div class="flex flex-row items-center space-x-2">
                                                <a class="flex flex-row space-x-1 items-center"
                                                   href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}">
                                                    <span class="uppercase"> {{ column.header }} </span>
                                                    {% if table.tooltips|get_item_lower:column.header != None %}
                                                        <svg
                                                                data-tooltip-target="tooltip-column-
                                                                        {{ table.tooltips|get_item_lower:column.header|get_item:'title' }}"
                                                                width="18" height="19" viewBox="0 0 18 19" fill="none"
                                                                xmlns="http://www.w3.org/2000/svg"
                                                        >
                                                            <path fill-rule="evenodd" clip-rule="evenodd"
                                                                  d="M16.1998 9.5C16.1998 11.4096 15.4412 13.2409 14.091 14.5912C12.7407 15.9414 10.9094 16.7 8.9998 16.7C7.09025 16.7 5.2589 15.9414 3.90864 14.5912C2.55837 13.2409 1.7998 11.4096 1.7998 9.5C1.7998 7.59044 2.55837 5.7591 3.90864 4.40883C5.2589 3.05857 7.09025 2.3 8.9998 2.3C10.9094 2.3 12.7407 3.05857 14.091 4.40883C15.4412 5.7591 16.1998 7.59044 16.1998 9.5V9.5ZM9.89981 5.9C9.89981 6.1387 9.80498 6.36762 9.6362 6.5364C9.46742 6.70518 9.2385 6.8 8.9998 6.8C8.76111 6.8 8.53219 6.70518 8.36341 6.5364C8.19463 6.36762 8.0998 6.1387 8.0998 5.9C8.0998 5.66131 8.19463 5.43239 8.36341 5.26361C8.53219 5.09482 8.76111 5 8.9998 5C9.2385 5 9.46742 5.09482 9.6362 5.26361C9.80498 5.43239 9.89981 5.66131 9.89981 5.9ZM8.0998 8.6C7.86111 8.6 7.63219 8.69482 7.46341 8.86361C7.29463 9.03239 7.1998 9.26131 7.1998 9.5C7.1998 9.7387 7.29463 9.96762 7.46341 10.1364C7.63219 10.3052 7.86111 10.4 8.0998 10.4V13.1C8.0998 13.3387 8.19463 13.5676 8.36341 13.7364C8.53219 13.9052 8.76111 14 8.9998 14H9.89981C10.1385 14 10.3674 13.9052 10.5362 13.7364C10.705 13.5676 10.7998 13.3387 10.7998 13.1C10.7998 12.8613 10.705 12.6324 10.5362 12.4636C10.3674 12.2948 10.1385 12.2 9.89981 12.2V9.5C9.89981 9.26131 9.80498 9.03239 9.6362 8.86361C9.46742 8.69482 9.2385 8.6 8.9998 8.6H8.0998Z"
                                                                  fill="#9CA3AF"/>
                                                        </svg>
                                                        <div
                                                                style="max-width: 12rem;"
                                                                id="tooltip-column-
                                                                        {{ table.tooltips|get_item_lower:column.header|get_item:'title' }}"
                                                                role="tooltip"
                                                                class="absolute z-10 invisible flex-col flex space-y-1 items-start px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-800 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700"
                                                        >
                                                            <h3 class="text-sm font-medium">
                                                                {{ table.tooltips|get_item_lower:column.header|get_item:'title' }}</h3>
                                                            <span class="text-xs font-normal text-gray-400 max-w-16">{{ table.tooltips|get_item_lower:column.header|get_item:'text' }}</span>
                                                            <div class="tooltip-arrow" data-popper-arrow></div>
                                                        </div>
                                                    {% endif %}
                                                </a>
                                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 ml-1"
                                                     aria-hidden="true" fill="currentColor" viewBox="0 0 320 512">
                                                    <path d="M27.66 224h264.7c24.6 0 36.89-29.78 19.54-47.12l-132.3-136.8c-5.406-5.406-12.47-8.107-19.53-8.107c-7.055 0-14.09 2.701-19.45 8.107L8.119 176.9C-9.229 194.2 3.055 224 27.66 224zM292.3 288H27.66c-24.6 0-36.89 29.77-19.54 47.12l132.5 136.8C145.9 477.3 152.1 480 160 480c7.053 0 14.12-2.703 19.53-8.109l132.3-136.8C329.2 317.8 316.9 288 292.3 288z"/>
                                                </svg>
                                            </div>
                                        {% else %}
                                            <span class="uppercase"> {{ column.header }} </span>
                                        {% endif %}
                                    </th>
                                {% endfor %}
                            </tr>
                            </thead>
                        {% endif %}
                    {% endblock table.thead %}
                    {% block table.tbody %}
                        <tbody {{ table.attrs.tbody.as_html }}>
                        {% for row in table.paginated_rows %}
                            {% block table.tbody.row %}
                                <tr class="transition-colors duration-200 bg-white border border-gray-200 dark:bg-gray-800 rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                                    {% for column, cell in row.items %}
                                        {% if "</th>" in cell %}
                                            {{ cell }}
                                        {% else %}
                                            <td class="break-words py-4 px-6">
                                                {% if column.localize == None %}{{ cell }}{% else %}
                                                    {% if column.localize %}
                                                        {{ cell|localize }}{% else %}{{ cell|unlocalize }}
                                                    {% endif %}{% endif %}
                                            </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            {% endblock table.tbody.row %}
                            {% empty %}
                            {% if table.empty_text %}
                                {% block table.tbody.empty_text %}
                                    <tr>
                                        <td colspan="{{ table.columns|length }}">{{ table.empty_text }}</td>
                                    </tr>
                                {% endblock table.tbody.empty_text %}
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    {% endblock table.tbody %}
                    {% block table.tfoot %}
                        {% if table.has_footer %}
                            <tfoot {{ table.attrs.tfoot.as_html }}>
                            <tr>
                                {% for column in table.columns %}
                                    <td {{ column.attrs.tf.as_html }}>{{ column.footer }}</td>
                                {% endfor %}
                            </tr>
                            </tfoot>
                        {% endif %}
                    {% endblock table.tfoot %}
                </table>
            </div>
        {% endblock table %}

        {% block pagination %}
            <nav class="flex items-center justify-between p-4" aria-label="Table navigation">
                <span class="text-sm font-normal text-gray-500 dark:text-gray-400">Showing <span
                        class="font-semibold text-gray-900 dark:text-white"> {{ table.page.start_index }}-{{ table.page.end_index }} </span> of <span
                        class="font-semibold text-gray-900 dark:text-white">{{ table.paginator.count }}</span> results </span>

                {% if table.page and table.paginator.num_pages > 1 %}
                    <ul class="inline-flex items-center -space-x-px">
                        {% if table.page.has_previous %}
                            {% block pagination.previous %}
                                <li class="previous">
                                    <a href="
                                            {% querystring table.prefixed_page_field=table.page.previous_page_number %}{% url_tab_param_persistence %}"
                                       class="block px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-blue-100 hover:text-blue-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                                        <span class="sr-only">Previous</span>
                                        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor"
                                             viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd"
                                                  d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                                  clip-rule="evenodd"></path>
                                        </svg>
                                    </a>
                                </li>
                            {% endblock pagination.previous %}
                        {% endif %}
                        {% if table.page.has_previous or table.page.has_next %}
                            {% block pagination.range %}
                                {% for p in table.page|table_page_range:table.paginator %}
                                    <li {% if p == table.page.number %}class="active"{% endif %}>
                                        {% if p == '...' %}
                                            <a href="#"
                                               class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-blue-100 hover:text-blue-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                                                {{ p }}
                                            </a>
                                        {% elif p > table.page.number|add:'-3' and p < table.page.number|add:'3' %}
                                            <a href="
                                                    {% querystring table.prefixed_page_field=p %}{% url_tab_param_persistence %}"
                                               class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-blue-100 hover:text-blue-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                                                {{ p }}
                                            </a>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            {% endblock pagination.range %}
                        {% endif %}
                        {% if table.page.has_next %}
                            {% block pagination.next %}
                                <li class="next">
                                    <a href="
                                            {% querystring table.prefixed_page_field=table.page.next_page_number %}{% url_tab_param_persistence %}"
                                       class="block px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-blue-100 hover:text-blue-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                                        <span class="sr-only">Next</span>
                                        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd"
                                                  d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                                  clip-rule="evenodd"></path>
                                        </svg>
                                    </a>
                                </li>
                            {% endblock pagination.next %}
                        {% endif %}
                    </ul>
                {% endif %}
            </nav>

        {% endblock pagination %}
    </div>
{% endblock table-wrapper %}
