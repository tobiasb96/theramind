{% load static %}

<div class="w-full">
    <div class="mb-2">
        <label for="{{ editor_id }}" class="block text-sm font-medium text-gray-700 mb-2">{{ label|default:"Editor" }}</label>
    </div>
    <div class="w-full border border-gray-200 rounded-lg bg-gray-50">
        <!-- Toolbar -->
        <div class="flex items-center justify-between border-b border-gray-200 bg-white px-4 py-2 rounded-t-lg">
            <div class="flex items-center space-x-1">
                <!-- Bold -->
                <button type="button" data-toolbar-target="toolbar-bold" class="p-2 text-gray-500 rounded cursor-pointer hover:text-gray-900 hover:bg-gray-100">
                    <svg class="w-4 h-4" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 5h4.5a3.5 3.5 0 1 1 0 7H8m0-7v7m0-7H6m2 7h6.5a3.5 3.5 0 1 1 0 7H8m0-7v7m0 0H6"/>
                    </svg>
                </button>
                
                <!-- Italic -->
                <button type="button" data-toolbar-target="toolbar-italic" class="p-2 text-gray-500 rounded cursor-pointer hover:text-gray-900 hover:bg-gray-100">
                    <svg class="w-4 h-4" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 4h-9M14 20H5M15 4L9 20"/>
                    </svg>
                </button>
                
                <!-- Underline -->
                <button type="button" data-toolbar-target="toolbar-underline" class="p-2 text-gray-500 rounded cursor-pointer hover:text-gray-900 hover:bg-gray-100">
                    <svg class="w-4 h-4" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3M4 21h16"/>
                    </svg>
                </button>
                
                <!-- Divider -->
                <div class="w-px h-6 bg-gray-300 mx-2"></div>
                
                <!-- Bullet List -->
                <button type="button" data-toolbar-target="toolbar-ul" class="p-2 text-gray-500 rounded cursor-pointer hover:text-gray-900 hover:bg-gray-100">
                    <svg class="w-4 h-4" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
                    </svg>
                </button>
                
                <!-- Numbered List -->
                <button type="button" data-toolbar-target="toolbar-ol" class="p-2 text-gray-500 rounded cursor-pointer hover:text-gray-900 hover:bg-gray-100">
                    <svg class="w-4 h-4" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 6h13M8 12h13M8 18h13M3 6h1v4H3V6zm0 6h1v4H3v-4zm2-6h14v2H5V6zm0 6h14v2H5v-2z"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Editor Area -->
        <div class="bg-white rounded-b-lg">
            <div class="px-4 py-2 bg-white rounded-b-lg">
                <div id="{{ editor_id }}" class="w-full text-sm text-gray-800 bg-white border-0 outline-none resize-none wysiwyg-editor" style="min-height: {{ min_height|default:'400px' }};" contenteditable="true" data-placeholder="{{ placeholder|default:'Text eingeben...' }}">{{ content|safe }}</div>
                <input type="hidden" name="{{ input_name }}" id="{{ editor_id }}-input" value="{{ content|escape }}">
            </div>
        </div>
    </div>
</div>

<style>
    /* WYSIWYG Editor Styles */
    .wysiwyg-editor {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        line-height: 1.6;
        color: #374151;
    }
    
    .wysiwyg-editor:focus {
        outline: none;
    }
    
    .wysiwyg-editor p {
        margin-bottom: 1rem;
    }
    
    .wysiwyg-editor ul, .wysiwyg-editor ol {
        margin-left: 1.5rem;
        margin-bottom: 1rem;
        list-style-position: outside;
    }
    
    .wysiwyg-editor ul {
        list-style-type: disc;
    }
    
    .wysiwyg-editor ol {
        list-style-type: decimal;
    }
    
    .wysiwyg-editor li {
        margin-bottom: 0.25rem;
        display: list-item;
    }
    
    /* Toolbar button active states */
    [data-toolbar-target].active {
        background-color: #3b82f6 !important;
        color: white !important;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const editor = document.getElementById('{{ editor_id }}');
    const hiddenInput = document.getElementById('{{ editor_id }}-input');
    
    if (editor) {
        // Initialize toolbar functionality
        const toolbarButtons = document.querySelectorAll('[data-toolbar-target]');
        
        toolbarButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const command = this.getAttribute('data-toolbar-target').replace('toolbar-', '');
                
                // Remove active class from all buttons
                toolbarButtons.forEach(btn => btn.classList.remove('active'));
                
                switch(command) {
                    case 'bold':
                        document.execCommand('bold', false, null);
                        if (document.queryCommandState('bold')) {
                            this.classList.add('active');
                        }
                        break;
                    case 'italic':
                        document.execCommand('italic', false, null);
                        if (document.queryCommandState('italic')) {
                            this.classList.add('active');
                        }
                        break;
                    case 'underline':
                        document.execCommand('underline', false, null);
                        if (document.queryCommandState('underline')) {
                            this.classList.add('active');
                        }
                        break;
                    case 'ul':
                        document.execCommand('insertUnorderedList', false, null);
                        // Ensure proper list styling
                        setTimeout(() => {
                            const lists = editor.querySelectorAll('ul');
                            lists.forEach(list => {
                                if (!list.style.listStyleType) {
                                    list.style.listStyleType = 'disc';
                                }
                            });
                        }, 10);
                        break;
                    case 'ol':
                        document.execCommand('insertOrderedList', false, null);
                        // Ensure proper list styling
                        setTimeout(() => {
                            const lists = editor.querySelectorAll('ol');
                            lists.forEach(list => {
                                if (!list.style.listStyleType) {
                                    list.style.listStyleType = 'decimal';
                                }
                            });
                        }, 10);
                        break;
                }
                
                // Update hidden input with current content
                updateHiddenInput();
            });
        });
        
        // Update toolbar state when selection changes
        editor.addEventListener('keyup', updateToolbarState);
        editor.addEventListener('mouseup', updateToolbarState);
        editor.addEventListener('input', updateToolbarState);
        
        function updateToolbarState() {
            toolbarButtons.forEach(button => {
                const command = button.getAttribute('data-toolbar-target').replace('toolbar-', '');
                
                switch(command) {
                    case 'bold':
                        if (document.queryCommandState('bold')) {
                            button.classList.add('active');
                        } else {
                            button.classList.remove('active');
                        }
                        break;
                    case 'italic':
                        if (document.queryCommandState('italic')) {
                            button.classList.add('active');
                        } else {
                            button.classList.remove('active');
                        }
                        break;
                    case 'underline':
                        if (document.queryCommandState('underline')) {
                            button.classList.add('active');
                        } else {
                            button.classList.remove('active');
                        }
                        break;
                }
            });
        }
        
        // Update hidden input when content changes
        editor.addEventListener('input', updateHiddenInput);
        editor.addEventListener('keyup', updateHiddenInput);
        editor.addEventListener('paste', updateHiddenInput);
        
        // Handle paste to clean up formatting
        editor.addEventListener('paste', function(e) {
            e.preventDefault();
            const text = (e.originalEvent || e).clipboardData.getData('text/plain');
            document.execCommand('insertText', false, text);
        });
        
        // Placeholder functionality
        if (!editor.textContent.trim()) {
            editor.textContent = editor.getAttribute('data-placeholder');
            editor.classList.add('text-gray-400');
        }
        
        editor.addEventListener('focus', function() {
            if (this.textContent === this.getAttribute('data-placeholder')) {
                this.textContent = '';
                this.classList.remove('text-gray-400');
            }
        });
        
        editor.addEventListener('blur', function() {
            if (!this.textContent.trim()) {
                this.textContent = this.getAttribute('data-placeholder');
                this.classList.add('text-gray-400');
            }
        });
        
        function updateHiddenInput() {
            hiddenInput.value = editor.innerHTML;
        }
        
        // Initialize with current content
        updateHiddenInput();
        
        // Ensure existing lists are properly styled
        function ensureListStyling() {
            const lists = editor.querySelectorAll('ul, ol');
            lists.forEach(list => {
                if (list.tagName === 'UL' && !list.style.listStyleType) {
                    list.style.listStyleType = 'disc';
                } else if (list.tagName === 'OL' && !list.style.listStyleType) {
                    list.style.listStyleType = 'decimal';
                }
            });
        }
        
        // Apply styling to existing lists
        ensureListStyling();
        
        // Also apply styling when content changes
        editor.addEventListener('input', ensureListStyling);
    }
});
</script> 